Express app started on port 7654
Executing (default): DELETE FROM `Accounts` WHERE 1=1
Executing (default): DELETE FROM `Accounts` WHERE 1=1
    <section class="suite">
      <h1>Account Authentication Service</h1>
      <dl>
        <section class="suite">
          <h1>POST /accounts/authenticate</h1>
          <dl>
Executing (default): DROP TABLE IF EXISTS `AccountProviders`;
            <section class="suite">
              <h1>Check response when some required fields are not sent.</h1>
              <dl>
[0mPOST /accounts/authenticate [33m404 [0m18.712 ms - 88[0m
                <dt>should response BAD REQUEST &amp; the error details when body is empty </dt>
                <dd><pre><code>var credentials = {};
request(app)
    .post('/accounts/authenticate')
    .send(credentials)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'username', msg: 'required' },{ param: 'password', msg: 'required' }]})
    .end(done);</code></pre></dd>
[0mPOST /accounts/authenticate [33m404 [0m3.231 ms - 50[0m
                <dt>should response BAD REQUEST &amp; the error details when username is empty </dt>
                <dd><pre><code>var credentials = {password:&quot;secret&quot;};
request(app)
    .post('/accounts/authenticate')
    .send(credentials)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'username', msg: 'required' }]})
    .end(done);</code></pre></dd>
[0mPOST /accounts/authenticate [33m404 [0m14.649 ms - 50[0m
                <dt>should response BAD REQUEST &amp; the error details when password is empty </dt>
                <dd><pre><code>var credentials = {username:&quot;email@mail.com&quot;};
request(app)
    .post('/accounts/authenticate')
    .send(credentials)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'password', msg: 'required' }]})
    .end(done);</code></pre></dd>
              </dl>
            </section>
            <section class="suite">
              <h1>Check response when credentials are not valid..</h1>
              <dl>
create account with following details: [object Object]
Executing (default): INSERT INTO `Accounts` (`id`,`username`,`password`,`salt`,`fullName`,`updatedAt`,`createdAt`) VALUES (NULL,'email1@email.com','007ba2bf3be46515577951f41e5ec3ff79ad33a2','569130210787','John Doe','2015-05-27 14:23:03.000 +00:00','2015-05-27 14:23:03.000 +00:00');
Executing (default): DROP TABLE IF EXISTS `Accounts`;
[0mPOST /accounts [33m404 [0m410.832 ms - 504[0m
Executing (default): SELECT `id`, `username`, `password`, `salt`, `fullName`, `status`, `type`, `createdAt`, `updatedAt` FROM `Accounts` AS `Account` WHERE `Account`.`username` = 'email1@email.com' LIMIT 1;
Executing (default): DROP TABLE IF EXISTS `Accounts`;
Executing (default): CREATE TABLE IF NOT EXISTS `Accounts` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `username` VARCHAR(255), `password` VARCHAR(255), `salt` VARCHAR(255), `fullName` VARCHAR(255), `status` TEXT, `type` TEXT, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL);
Executing (default): PRAGMA INDEX_LIST(`Accounts`)
Executing (default): DROP TABLE IF EXISTS `AccountProviders`;
Executing (default): CREATE TABLE IF NOT EXISTS `AccountProviders` (`id` INTEGER PRIMARY KEY AUTOINCREMENT, `providerId` VARCHAR(255), `provider` TEXT, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, `accountId` INTEGER REFERENCES `Accounts` (`id`) ON DELETE SET NULL ON UPDATE CASCADE);
Executing (default): PRAGMA INDEX_LIST(`AccountProviders`)
                <dt class="error">should response UnAuthorized &amp; return a error response</dt>
                <dd class="error"><pre><code>var account = {fullName: 'John Doe', username: 'email1@email.com', password: 'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect(201)
    .end(function(err, res) {
        if (err) return done(err);
        var credentials = {username: account.username, password: 'badPassword'};
        request(app)
            .post('/accounts/authenticate')
            .send(credentials)
            .set('Content-Type', 'application/json')
            .expect(401)
            .expect({&quot;errors&quot;: [{&quot;param&quot;: &quot;credentials&quot;, &quot;msg&quot;: &quot;invalid&quot;}]})
            .end(done);
    });</code></pre></dd>
                <dd class="error">Error: timeout of 10000ms exceeded</dd>
              </dl>
            </section>
            <section class="suite">
              <h1>Check response when user is not registered yet..</h1>
              <dl>
Executing (default): SELECT `id`, `username`, `password`, `salt`, `fullName`, `status`, `type`, `createdAt`, `updatedAt` FROM `Accounts` AS `Account` WHERE `Account`.`username` = 'notfound@email.com' LIMIT 1;
[0mPOST /accounts/authenticate [33m404 [0m11.951 ms - 79[0m
                <dt>should response Not found &amp; return a error response</dt>
                <dd><pre><code>var account = {fullName: 'John Doe', username: 'email1@email.com', password: 'secret'};
var credentials = {username: 'notfound@email.com', password: 'badPassword'};
request(app)
    .post('/accounts/authenticate')
    .send(credentials)
    .set('Content-Type', 'application/json')
    .expect(404)
    .expect({&quot;errors&quot;: [{&quot;param&quot;: &quot;username&quot;, &quot;msg&quot;: &quot;notfound&quot;, &quot;value&quot;: credentials.username}]})
    .end(done);</code></pre></dd>
              </dl>
            </section>
            <section class="suite">
              <h1>Check response when user is authenticated correctly.</h1>
              <dl>
create account with following details: [object Object]
Executing (default): INSERT INTO `Accounts` (`id`,`username`,`password`,`salt`,`fullName`,`updatedAt`,`createdAt`) VALUES (NULL,'email2@email.com','f6ccd7d0cac3775574b0db5c90b63c748e2f6a26','1223328053900','John Doe','2015-05-27 14:23:13.000 +00:00','2015-05-27 14:23:13.000 +00:00');
[0mPOST /accounts [33m404 [0m162.575 ms - 504[0m
                <dt>should response UnAuthorized &amp; return account details</dt>
                <dd><pre><code>var account = {fullName: 'John Doe', username: 'email2@email.com', password: 'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect(201)
    .end(function(err, res){
        if (err) return done(err);
        var credentials = {username: account.username, password: account.password};
        request(app)
            .post('/accounts/authenticate')
            .send(credentials)
            .set('Content-Type', 'application/json')
            .expect(200)
            .end(function(err,res) {
                if (err) return done(err);
                res.body.publicId.should.match(/\b[0-9a-f]{5,40}\b/);
                res.body.username.should.equal(account.username);
                res.body.fullName.should.equal(account.fullName);
            });
            done();
    });</code></pre></dd>
Executing (default): SELECT `id`, `username`, `password`, `salt`, `fullName`, `status`, `type`, `createdAt`, `updatedAt` FROM `Accounts` AS `Account` WHERE `Account`.`username` = 'email2@email.com' LIMIT 1;
              </dl>
            </section>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>Account Creation Service</h1>
      <dl>
        <section class="suite">
          <h1>POST /accounts</h1>
          <dl>
[0mPOST /accounts/authenticate [33m404 [0m7.866 ms - 504[0m
            <section class="suite">
              <h1>Check response when some required fields are not sent.</h1>
              <dl>
create account with following details: [object Object]
[0mPOST /accounts [33m404 [0m4.155 ms - 50[0m
                <dt>should response BAD REQUEST &amp; the error details when fullName is empty </dt>
                <dd><pre><code>var account = {username:'john.doe@mail.com',password:'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'fullName', msg: 'required' }]})
    .end(done);</code></pre></dd>
create account with following details: [object Object]
[0mPOST /accounts [33m404 [0m3.490 ms - 50[0m
                <dt>should response BAD REQUEST &amp; the error details when username is empty </dt>
                <dd><pre><code>var account = {fullName:'John Doe',password:'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'username', msg: 'required' }]})
    .end(done);</code></pre></dd>
create account with following details: [object Object]
[0mPOST /accounts [33m404 [0m2.176 ms - 88[0m
                <dt>should response BAD REQUEST &amp; the error details when username &amp; password are empty </dt>
                <dd><pre><code>var account = {fullName:'John Doe'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{ param: 'username', msg: 'required' },{ param: 'password', msg: 'required' }]})
    .end(done);</code></pre></dd>
              </dl>
            </section>
            <section class="suite">
              <h1>Check response when even though the required fields are sent, they have some invalid format.</h1>
              <dl>
create account with following details: [object Object]
[0mPOST /accounts [33m404 [0m1.888 ms - 70[0m
                <dt>should response BAD REQUEST &amp; the error details when username is not a valid email </dt>
                <dd><pre><code>var invalidEmail ='novalid.com';
var account = {fullName: 'John Doe', username: invalidEmail, password: 'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(400)
    .expect({errors:[{param: 'username', msg: 'format', value: invalidEmail}]})
    .end(done);</code></pre></dd>
              </dl>
            </section>
            <section class="suite">
              <h1>Check response when account is created successfully.</h1>
              <dl>
Executing (default): DELETE FROM `Accounts` WHERE 1=1
create account with following details: [object Object]
Executing (default): INSERT INTO `Accounts` (`id`,`username`,`password`,`salt`,`fullName`,`updatedAt`,`createdAt`) VALUES (NULL,'email@email.com','902411ad787a8221097ffc8ebe0bd5e2ba7eac75','368319655906','John Doe','2015-05-27 14:23:14.000 +00:00','2015-05-27 14:23:14.000 +00:00');
[0mPOST /accounts [33m404 [0m303.553 ms - 503[0m
                <dt>should response CREATED &amp; return a valid response</dt>
                <dd><pre><code>var account = {fullName: 'John Doe', username: 'email@email.com', password: 'secret'};
request(app)
    .post('/accounts')
    .send(account)
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(201)
    .end(function(err,res){
        if (err) return done(err);
        res.body.publicId.should.match(/\b[0-9a-f]{5,40}\b/);
        res.body.username.should.equal(account.username);
        res.body.fullName.should.equal(account.fullName);
        /**
        res.body.links.should.equal(
            [
                {
                    'rel':'self',
                    'method':'GET',
                    'href':'http://127.0.0.1:7654/api/v1/accounts/'+res.body.publicId
                },
                {
                    'rel':'delete',
                    'method':'DELETE',
                    'href':'http://127.0.0.1:7654/api/v1/accounts/'+res.body.publicId
                },
                {
                    'rel':'update',
                    'method':'PUT',
                    'href':'http://127.0.0.1:7654/api/v1/accounts/'+res.body.publicId
                }
            ]
        );
         **/
        done();
    });
models.Account.destroy({truncate:true});</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
      </dl>
    </section>
    <section class="suite">
      <h1>Status Service</h1>
      <dl>
        <section class="suite">
          <h1>GET /monitor/status - Test Server status</h1>
          <dl>
            <section class="suite">
              <h1>Check http status code &amp; body response</h1>
              <dl>
[0mGET /monitor/status [33m404 [0m1.200 ms - 14[0m
                <dt>should response 200 and all the services should be running</dt>
                <dd><pre><code>request(app)
    .get('/monitor/status')
    .set('Content-Type', 'application/json')
    .expect('Content-Type', 'application/json; charset=utf-8')
    .expect(200)
    .expect({
        'server':'0'
    }).end(done);</code></pre></dd>
              </dl>
            </section>
          </dl>
        </section>
      </dl>
    </section>
